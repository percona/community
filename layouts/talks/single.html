{{ define "css" -}}
  {{- .Page.Scratch.Add "css" (partial "scss" (dict "file" "scss/talks.scss") | safeCSS) -}}
  {{- .Page.Scratch.Add "css" (partial "scss" (dict "file" "scss/bio.scss") | safeCSS) -}}
{{- end }}

{{ define "main" }}

  <article class="talk text" itemscope itemtype="https://schema.org/BlogPosting">
    {{ with .Params.images }}<meta itemprop="image" content="{{ (resources.Get (index . 0)).Permalink }}" />{{ end }}
    <meta itemprop="mainEntityOfPage" content="{{ .Permalink }}" />
    {{ with .Params.talk_tags}}<meta itemprop="keywords" content="{{ delimit . ", " }}" />{{ end }}

    <h1 itemprop="name headline">{{ .Title }}</h1>

    <!-- Header: Meta + Speakers -->
    <div class="talk-header">
      <!-- Meta Information -->
      <div class="talk-meta">
        {{ if .Params.event }}
        <div class="talk-meta__item">
          <span class="meta-label">Event</span>
          <span class="meta-value">
            {{ if .Params.event_url }}
              <a href="{{ .Params.event_url }}" target="_blank" rel="noopener">{{ .Params.event }}</a>
            {{ else }}
              {{ .Params.event }}
            {{ end }}
          </span>
        </div>
        {{ end }}

        {{ if .Params.event_location }}
        <div class="talk-meta__item">
          <span class="meta-label">Location</span>
          <span class="meta-value">{{ .Params.event_location }}</span>
        </div>
        {{ end }}

        {{ if or .Params.event_date_start .Params.event_date_end }}
        <div class="talk-meta__item">
          <span class="meta-label">Dates</span>
          <span class="meta-value">
            {{ if .Params.event_date_start }}
              {{ .Params.event_date_start | time.Format "Jan 2, 2006" }}
            {{ end }}
            {{ if .Params.event_date_end }}
              {{ if .Params.event_date_start }} â€“ {{ end }}{{ .Params.event_date_end | time.Format "Jan 2, 2006" }}
            {{ end }}
          </span>
        </div>
        {{ end }}

        {{ if or .Params.presentation_date .Params.presentation_time }}
        <div class="talk-meta__item">
          <span class="meta-label">Presentation</span>
          <span class="meta-value">
            {{ if .Params.presentation_date }}
              {{ .Params.presentation_date | time.Format "Jan 2, 2006" }}
            {{ end }}
            {{ if .Params.presentation_time }}
              {{ if .Params.presentation_date }}, {{ end }}{{ .Params.presentation_time }}
            {{ end }}
          </span>
        </div>
        {{ end }}

        {{ with .Params.slides }}
        <div class="talk-meta__item">
          <span class="meta-label">Slides</span>
          <span class="meta-value">
            {{ if or (hasPrefix . "http://") (hasPrefix . "https://") }}
              <a href="{{ . }}" target="_blank" rel="noopener" class="talk-link">ğŸŒ External Slides</a>
            {{ else }}
              <a href="{{ . }}" target="_blank" rel="noopener" class="talk-link">ğŸ“¥ Download Slides (PDF)</a>
            {{ end }}
          </span>
        </div>
        {{ end }}

        {{ with .Params.video }}
        <div class="talk-meta__item">
          <span class="meta-label">Video</span>
          <span class="meta-value">
            <a href="{{ . }}" target="_blank" rel="noopener" class="talk-link">â–¶ï¸ Watch video</a>
          </span>
        </div>
        {{ end }}

        {{ with .Params.talk_url }}
        <div class="talk-meta__item">
          <span class="meta-label">Link</span>
          <span class="meta-value">
            <a href="{{ . }}" target="_blank" rel="noopener" class="talk-link">ğŸ”— On event website</a>
          </span>
        </div>
        {{ end }}
      </div>

      <!-- Speakers -->
      <div class="talk-header__speakers">
        <div class="talk-header__title">
          {{ if eq (len .Params.speakers) 1 }}Speaker{{ else }}Speakers{{ end }}
        </div>
        {{ range $speaker := .Params.speakers }}
          {{ $c := $.Site.GetPage (print "/contributors/" $speaker) }}
          {{ with $c }}
            <div class="talk-card__speaker-block">
              {{ with .Params.images }}
                <a href="{{ $c.RelPermalink }}" class="talk-card__speaker-avatar">
                  <img src="{{ ((resources.Get (index . 0)).Fill "80x80 90% jpg").RelPermalink }}" alt="{{ $c.Params.fullname }}" class="avatar"/>
                </a>
              {{ end }}
              <div class="talk-card__speaker-info">
                <a href="{{ $c.RelPermalink }}" class="talk-card__speaker-link">
                  <strong>{{ $c.Params.fullname }}</strong>
                </a>
                {{ with $c.Params.tagline }}
                  <p class="talk-card__speaker-tagline">{{ . }}</p>
                {{ end }}
                {{ with $c.Params.job }}
                  <p class="talk-card__speaker-job">{{ . }}</p>
                {{ end }}
              </div>
            </div>
          {{ end }}
        {{ end }}
      </div>
    </div>

    <!-- Tags -->
    {{ if .Params.talk_tags }}
    <div class="talk-tags">
    <span class="tags-label">Tags:</span>
    {{ range $index, $tag := .Params.talk_tags }}
        <a href="/talk_tags/{{ $tag | urlize }}/" class="tag">#{{ $tag }}</a>
    {{ end }}
    </div>
    {{ end }}

    <!-- Abstract -->
    <div itemprop="articleBody" class="body">
      {{ partial "content.html" . }}
      {{ if .Params.youtube_id }}
        <div class="talk-video-section">
          <h2>Video</h2>
          <a href="https://youtu.be/{{ .Params.youtube_id }}" target="_blank" rel="noopener noreferrer">
            <img 
              src="https://img.youtube.com/vi/{{ .Params.youtube_id }}/hqdefault.jpg" 
              alt="Watch on YouTube: {{ .Title }}" 
              loading="lazy"
              width="480"
              style="border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);"
            >
          </a>
          <p class="video-link">
            â–¶ï¸ Watch on: 
            <a href="https://youtu.be/{{ .Params.youtube_id }}" target="_blank" rel="noopener noreferrer">
              YouTube
            </a>
          </p>
        </div>
      {{ end }}

      {{ with .Params.images }}
        <h2>Speaker card</h2>
        <div style="max-width: 800px;">
        <img width="100%" height="100%" 
             src="{{ ((resources.Get (index . 0)).Fill "1200x630 80% jpg").RelPermalink }}" 
             alt="{{ $.Page.Title}}" />
        </div>
      {{ end }}
    </div>

    <!-- Speaker Bios -->
    {{ if isset .Params "speakers" }}
      {{ partial "contributors-bios.html" . }}
    {{ end }}

    <!-- Sharing -->
    {{ partial "sharing.html" . }}

    <!-- Recommendations -->
    {{ partial "talk-recommendations.html" . }}

  </article>
{{ end }}
