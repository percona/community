---
title: 'PMM Client on Raspberry Pi 4'
date: "2023-08-15T00:00:00+00:00"
draft: false
tags: ['Percona', 'MySQL', 'PMM', 'monitoring', 'performance']
authors:
  - wayne
images: 
  - blog/2023/08/fresh-raspi.png
slug: 
---
This will be the third in my series of Percona Products on a Raspberry Pi. My previous posts:
 - [How to Build a Percona Server "Stack" on a Raspberry Pi 3+
](https://percona.community/blog/2019/08/01/how-to-build-a-percona-server-stack-on-a-raspberry-pi-3/)
 - [Raspberry Pi Bullseye Percona Server 64bit](https://percona.community/blog/2022/04/05/percona-server-raspberry-pi/)

Before I get started I would like to thank [guriandoro](https://gist.github.com/guriandoro), for the work he did in complying the PMM Client tools.

Now as most of you know I love the Raspberry Pi and I love running MySQL on it for my hobby projects. I recently decided that I need to be able to monitor the two MySQL Server here at home.

When I started out on this adventure I was not sure what resources I would find. I found several resources but I was not able to get the PMM Client running with either of them. So I documented what I was able to get working from the resources I found.

**In this BLOG we will be using PMM Client 2.17 and PMM Server version 2.39.**

## Prerequisites

I will assume if you have made it this far into the BLOG post, then you already have a running PMM Server. If not, you can read about installing a PMM Server [here](https://www.percona.com/software/pmm/quickstart).

### Add the pmm user to your MySQL Server
```
CREATE USER 'pmm'@'127.0.0.1' IDENTIFIED BY 'pass' WITH MAX_USER_CONNECTIONS 10;
GRANT SELECT, PROCESS, REPLICATION CLIENT, RELOAD, BACKUP_ADMIN ON *.* TO 'pmm'@'localhost';
```

**Important Note:** Your Raspberry Pi must be on Raspbian Bullseye.

## The following steps should be run on your Raspberry Pi

---

### Download git repo for pmm-client tools

```
cd 
wget  https://github.com/guriandoro/pmm_arm/archive/refs/heads/master.zip
unzip master.zip
```

Once we have the client unzipped its a good idea to verify that the tools will work on your Raspberry Pi.

```
cd ~/pmm_arm-master/raspbian.10.armv7l
./pmm-agent --version
```
You should get output like below.
```
ProjectName: pmm-agent
Version: 2.17.0-7-gb0318a3
PMMVersion: 2.17.0-7-gb0318a3
Timestamp: 2021-05-21 16:00:41 (UTC)
FullCommit: b0318a3d2ac3c17d53150f305469abe73b59f231
Branch: master
```

If the pmm-agent displayed info like above, then you good to keep moving down the document. If you ran into issues please post in the comments and we can see what can be done to get you working. The only problem I ran in to was that the root user could not execute the client tools.

## Setup install directories

We need to create the install directory and move files to the correct locations.
```
sudo mkdir -p /usr/local/percona
sudo mkdir -p /usr/local/percona/pmm2
sudo mkdir -p /usr/local/percona/pmm2/tools
sudo mkdir -p /usr/local/percona/pmm2/config
sudo mkdir -p /usr/local/percona/pmm2/exporters
sudo mkdir -p /usr/local/percona/exporters
sudo mkdir -p /usr/local/percona/exporters/collectors/textfile-collector/high-resolution
sudo mkdir -p /usr/local/percona/exporters/collectors/textfile-collector/medium-resolution
sudo mkdir -p /usr/local/percona/exporters/collectors/textfile-collector/low-resolution
```

### Copy files into directories
```
cd ~/pmm_arm-master/raspbian.10.armv7l
sudo cp pmm-admin pmm-agent /usr/local/bin
sudo cp node_exporter vmagent /usr/local/percona/pmm2/exporters
```

## Configure the PMM Client
Its time to configure and test the PMM Client for the MySQL server where we are install PMM Client.

Please make sure you have the following three items:

1. PMM Server Hostname or IP Address
2. PMM Server admin ID
3. PMM Server admin Password

```
sudo pmm-agent setup --config-file=/usr/local/percona/pmm2/config/pmm-agent.yaml\
 --server-address=<YOUR-PMM-Server> --server-insecure-tls\
 --server-username=<YOURADMIN> --server-password=<YOURPASSWORD>
```
Now that the PMM Client has been configured, lets move on to starting the PMM Client.

## Start the PMM Client

```
 sudo pmm-agent --config-file=/usr/local/percona/pmm2/config/pmm-agent.yaml
```
Verify by reviewing the client is running correctly. If all is well you should see output like:
```
INFO[2023-08-15T17:00:34.294-04:00] Loading configuration file /usr/local/percona/pmm2/config/pmm-agent.yaml.  component=main
INFO[2023-08-15T17:00:34.295-04:00] Using /usr/local/percona/pmm2/exporters/node_exporter  component=main
INFO[2023-08-15T17:00:34.295-04:00] Using /usr/local/percona/pmm2/exporters/mysqld_exporter  component=main
INFO[2023-08-15T17:00:34.295-04:00] Using /usr/local/percona/pmm2/exporters/mongodb_exporter  component=main
INFO[2023-08-15T17:00:34.295-04:00] Using /usr/local/percona/pmm2/exporters/postgres_exporter  component=main
INFO[2023-08-15T17:00:34.295-04:00] Using /usr/local/percona/pmm2/exporters/proxysql_exporter  component=main
INFO[2023-08-15T17:00:34.295-04:00] Using /usr/local/percona/pmm2/exporters/rds_exporter  component=main
INFO[2023-08-15T17:00:34.295-04:00] Using /usr/local/percona/pmm2/exporters/azure_exporter  component=main
INFO[2023-08-15T17:00:34.296-04:00] Using /usr/local/percona/pmm2/exporters/vmagent  component=main
INFO[2023-08-15T17:00:34.296-04:00] Starting...                                   component=client
INFO[2023-08-15T17:00:34.296-04:00] Starting local API server on http://127.0.0.1:7777/ ...  component=local-server/JSON
INFO[2023-08-15T17:00:34.296-04:00] Connecting to https://admin:***@192.168.1.127:443/ ...  component=client
INFO[2023-08-15T17:00:34.298-04:00] Started.                                      component=local-server/JSON
INFO[2023-08-15T17:00:34.320-04:00] Connected to 192.168.1.127:443.               component=client
INFO[2023-08-15T17:00:34.320-04:00] Establishing two-way communication channel ...  component=client
INFO[2023-08-15T17:00:34.341-04:00] Two-way communication channel established in 21.349589ms. Estimated clock drift: -84.399159ms.  component=client
```
At this point press ctl+c to stop the pmm-agent.

If you want to start the pmm-agent again and running the background use this command:
```
sudo nohup pmm-agent --config-file=/usr/local/percona/pmm2/config/pmm-agent.yaml &
```
You may choose a different startup method based on personal preference.

## Add your Raspberry Pi MySQL Server to PMM Server

I am sure most of you know how to add a server to your existing PMM Server but if you have not done this before here is what you need to do.

1. Connect to your PMM Server.
2. Use pmm-admin command to add server for monitoring.

```
/usr/local/percona/pmm2/bin/pmm-admin add mysql --service-name=<MYSQL SERVER NAME> --server-insecure-tls --server-url=https://<YOUR ADMIN>:<YOUR PASSWORD>@localhost --username=<DB USER> --password=<DB PASSWORD> --host=<MYSQL SERVER NAME>
```

## PMM Server Screen Shoot

![image](blog/2023/08/pmm-view2.png)

I hope you found this helpful. I know enjoyed learning the process and documenting to share with you!

## Whats Next?

I am going to work on compiling a new version of the PMM Client. I will update this blog post with any new details.

